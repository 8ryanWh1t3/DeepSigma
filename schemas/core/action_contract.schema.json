{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://sigma-overwatch.dev/schemas/action_contract.schema.json",
  "title": "Action Contract",
  "description": "Supports legacy episode actions and DISR authority action contracts.",
  "oneOf": [
    {
      "title": "DISR Authority Action Contract",
      "type": "object",
      "required": [
        "action_id",
        "action_type",
        "requested_by",
        "dri",
        "approver",
        "timestamp",
        "ttl",
        "signature"
      ],
      "properties": {
        "action_id": { "type": "string", "minLength": 8 },
        "action_type": { "type": "string", "enum": ["ROTATE_KEYS", "REENCRYPT"] },
        "requested_by": { "type": "string", "minLength": 1 },
        "dri": { "type": "string", "minLength": 1 },
        "approver": { "type": "string", "minLength": 1 },
        "timestamp": { "type": "string", "format": "date-time" },
        "ttl": { "type": "integer", "minimum": 1 },
        "signature": { "type": "string", "minLength": 32 }
      },
      "additionalProperties": false
    },
    {
      "title": "Legacy Episode Action",
      "type": "object",
      "required": ["actionId", "actionType"],
      "properties": {
        "actionId": { "type": "string", "minLength": 1 },
        "actionType": { "type": "string", "minLength": 1 },
        "blastRadiusTier": {
          "type": "string",
          "enum": ["tiny", "small", "medium", "large", "low", "high"]
        },
        "targetRefs": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["type", "id"],
            "properties": {
              "type": { "type": "string" },
              "id": { "type": "string" }
            },
            "additionalProperties": false
          }
        },
        "constraints": { "type": "object" },
        "authorization": {
          "type": "object",
          "properties": {
            "mode": { "type": "string", "enum": ["auto", "hitl", "blocked"] },
            "policyRef": { "type": "string" },
            "approver": { "type": "string" }
          },
          "additionalProperties": true
        },
        "idempotencyKey": { "type": "string" },
        "rollbackPlan": { "type": "object" },
        "execution": { "type": "object" }
      },
      "additionalProperties": true
    }
  ]
}

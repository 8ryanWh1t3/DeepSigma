<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Σ OVERWATCH Dashboard — Demo</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>Σ</text></svg>"/>
<script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://unpkg.com/recharts@2.10.3/umd/Recharts.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{font-family:Inter,system-ui,Avenir,Helvetica,Arial,sans-serif;color-scheme:dark}
body{background:#020617;color:#f1f5f9;min-height:100vh}
::-webkit-scrollbar{width:8px;height:8px}
::-webkit-scrollbar-track{background:#0f172a}
::-webkit-scrollbar-thumb{background:#334155;border-radius:4px}
::-webkit-scrollbar-thumb:hover{background:#475569}

.header{border-bottom:1px solid #1e293b;background:#0f172a;position:sticky;top:0;z-index:50}
.header-inner{max-width:1280px;margin:0 auto;padding:16px;display:flex;align-items:center;justify-content:space-between}
.logo{font-size:1.5rem;font-weight:700;color:#60a5fa}
.logo-sub{font-size:0.875rem;color:#94a3b8;margin-left:12px}
.controls{display:flex;align-items:center;gap:16px;font-size:0.875rem;color:#94a3b8}
.controls label{display:flex;align-items:center;gap:6px;cursor:pointer}
.controls input[type=checkbox]{accent-color:#60a5fa}
.ts{font-size:0.75rem;color:#64748b}

nav{border-bottom:1px solid #1e293b;background:#0f172a}
nav .inner{max-width:1280px;margin:0 auto;padding:0 16px;display:flex;gap:4px}
nav button{padding:12px 16px;font-size:0.875rem;font-weight:500;border:none;background:none;color:#94a3b8;cursor:pointer;border-bottom:2px solid transparent;transition:color .15s,border-color .15s}
nav button:hover{color:#cbd5e1}
nav button.active{color:#60a5fa;border-bottom-color:#3b82f6}

main{max-width:1280px;margin:0 auto;padding:24px}

.grid4{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
@media(max-width:900px){.grid4{grid-template-columns:repeat(2,1fr)}}
@media(max-width:500px){.grid4{grid-template-columns:1fr}}

.kpi{background:#0f172a;border:1px solid #1e293b;border-radius:8px;padding:16px}
.kpi-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.kpi-label{color:#94a3b8;font-size:0.875rem}
.kpi-icon{color:#60a5fa}
.kpi-value{font-size:1.5rem;font-weight:700}
.kpi-trend{font-size:0.75rem;color:#64748b}

.card{background:#0f172a;border:1px solid #1e293b;border-radius:8px;padding:24px;margin-top:24px}
.card h3{font-size:1.125rem;font-weight:600;margin-bottom:16px}

.grid2{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-top:24px}
@media(max-width:900px){.grid2{grid-template-columns:1fr}}
.span2{grid-column:1/-1}

table{width:100%;font-size:0.875rem;border-collapse:collapse}
thead{border-bottom:1px solid #334155}
th{text-align:left;padding:8px 12px;color:#cbd5e1;font-weight:500}
td{padding:8px 12px}
tr{border-bottom:1px solid #1e293b}
tr:hover{background:#1e293b}
.badge{padding:2px 8px;border-radius:4px;font-size:0.75rem;font-weight:500;display:inline-block}
.badge-success{background:#064e3b;color:#6ee7b7}
.badge-timeout{background:#7f1d1d;color:#fca5a5}
.badge-degraded{background:#78350f;color:#fcd34d}
.badge-failed{background:#581c87;color:#d8b4fe}
.mono{font-family:monospace;font-size:0.75rem;color:#94a3b8}

.drift-item{padding:12px;border-radius:6px;margin-bottom:8px}
.drift-high{background:rgba(127,29,29,.2);border:1px solid #991b1b}
.drift-medium{background:rgba(120,53,15,.2);border:1px solid #92400e}
.drift-low{background:rgba(30,58,138,.2);border:1px solid #1e3a8a}
.drift-header{display:flex;justify-content:space-between;align-items:flex-start}
.drift-title{font-weight:600;text-transform:capitalize}
.drift-ep{font-family:monospace;font-size:0.75rem;color:#94a3b8;margin-top:4px}
.drift-hint{font-size:0.875rem;color:#cbd5e1;margin-top:8px}
.sev{padding:2px 8px;border-radius:4px;font-size:0.75rem;font-weight:500;white-space:nowrap}
.sev-high{background:#7f1d1d;color:#fca5a5}
.sev-medium{background:#78350f;color:#fcd34d}
.sev-low{background:#1e3a8a;color:#93c5fd}

.export-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:24px}
.export-stat{padding:16px;background:#1e293b;border-radius:6px}
.export-stat-label{font-size:0.875rem;color:#94a3b8}
.export-stat-value{font-size:1.5rem;font-weight:700}
.btn{background:#2563eb;color:#fff;font-weight:600;padding:8px 16px;border:none;border-radius:6px;cursor:pointer;transition:background .15s}
.btn:hover{background:#1d4ed8}
.note{font-size:0.75rem;color:#64748b;margin-top:16px}

.scroll-box{max-height:600px;overflow-y:auto}
.flex-center{display:flex;align-items:center;gap:8px}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useCallback } = React;
const { LineChart, Line, BarChart, Bar, PieChart, Pie, Cell, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;

/* ── Mock Data ─────────────────────────────────────────── */
const AGENTS = ['ReasoningAgent','PlannerAgent','ExecutorAgent','VerifierAgent'];
const DECISIONS = ['Execute trade','Approve transaction','Route request','Generate response','Allocate resources'];
const DRIFT_TYPES = ['time','freshness','fallback','bypass','verify','outcome'];
const PATCH_HINTS = ['TTL policy','deadline configuration','fallback strategy','bypass conditions'];

function mockEpisodes(n=100){
  const now=Date.now(), eps=[];
  for(let i=0;i<n;i++){
    const dl=500+Math.random()*4500, dur=dl*(0.5+Math.random()*0.9);
    const st=dur>dl?'timeout':Math.random()>.9?'degraded':Math.random()>.95?'failed':'success';
    eps.push({id:`ep_${now}_${i}`,agent:AGENTS[Math.random()*4|0],ts:now-(n-i)*5000,
      deadline:dl,duration:dur,status:st,freshness:95+Math.random()*5,
      dataAge:Math.random()*5000,distance:Math.random()*15|0,
      variability:100+Math.random()*50,drag:Math.random()*200,
      decision:DECISIONS[Math.random()*5|0],
      verification:Math.random()>.1?'Verified':'Skipped',
      outcome:st==='success'?'Committed':'Rolled back'});
  }
  return eps;
}

function mockDrifts(n=100){
  const now=Date.now(), out=[];
  for(let i=0;i<n*.15;i++){
    out.push({id:`drift_${now}_${i}`,epId:`ep_${now}_${Math.random()*n|0}`,
      type:DRIFT_TYPES[Math.random()*6|0],
      severity:Math.random()>.7?'high':Math.random()>.5?'medium':'low',
      ts:now-(n-i)*500,
      patch:`Review ${PATCH_HINTS[Math.random()*4|0]}`});
  }
  return out;
}

function mockMetrics(){
  return AGENTS.map(a=>({agent:a,successRate:85+Math.random()*14,
    avgLatency:150+Math.random()*200,p95:300+Math.random()*300,
    p99:450+Math.random()*350,timeoutRate:Math.random()*8,
    degradedRate:Math.random()*5,freshness:92+Math.random()*8}));
}

/* ── SVG Icons (inline) ────────────────────────────────── */
const Icon=({d,size=20})=>(
  <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d={d}/></svg>
);
const TrendingUp=()=><Icon d="M22 7l-8.5 8.5-5-5L2 17"/>;
const ClockIcon=()=><Icon d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zM12 6v6l4 2"/>;
const ZapIcon=()=><Icon d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>;
const ActivityIcon=()=><Icon d="M22 12h-4l-3 9L9 3l-3 9H2"/>;
const AlertIcon=()=><Icon d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zM12 8v4M12 16h.01"/>;

/* ── KPI Card ──────────────────────────────────────────── */
function KPI({icon,label,value,trend}){
  return(
    <div className="kpi">
      <div className="kpi-top"><span className="kpi-label">{label}</span><span className="kpi-icon">{icon}</span></div>
      <div className="kpi-value">{value}</div>
      <div className="kpi-trend">{trend}</div>
    </div>
  );
}

/* ── Overview ──────────────────────────────────────────── */
function Overview({episodes,drifts,metrics}){
  const sr=episodes.length?(episodes.filter(e=>e.status==='success').length/episodes.length*100).toFixed(1):0;
  const al=episodes.length?(episodes.reduce((s,e)=>s+e.duration,0)/episodes.length).toFixed(0):0;
  const trend=episodes.sort((a,b)=>a.ts-b.ts).slice(-30).map(e=>({time:new Date(e.ts).toLocaleTimeString(),duration:Math.round(e.duration),deadline:Math.round(e.deadline)}));
  const statusDist=[
    {name:'Success',value:episodes.filter(e=>e.status==='success').length},
    {name:'Timeout',value:episodes.filter(e=>e.status==='timeout').length},
    {name:'Degraded',value:episodes.filter(e=>e.status==='degraded').length},
    {name:'Failed',value:episodes.filter(e=>e.status==='failed').length}
  ];
  const driftDist=drifts.reduce((a,d)=>{const f=a.find(x=>x.name===d.type);f?f.value++:a.push({name:d.type,value:1});return a;},[]);
  const COLORS=['#10b981','#f59e0b','#ef4444','#8b5cf6'];
  const ttStyle={backgroundColor:'#1e293b',border:'1px solid #475569',color:'#f1f5f9'};

  return(
    <div>
      <div className="grid4">
        <KPI icon={<TrendingUp/>} label="Success Rate" value={sr+'%'} trend="+2.5%"/>
        <KPI icon={<ClockIcon/>} label="Avg Latency" value={al+'ms'} trend="-5%"/>
        <KPI icon={<ZapIcon/>} label="Drift Events" value={drifts.length} trend={drifts.length>5?'+1':'-1'}/>
        <KPI icon={<ActivityIcon/>} label="Active Agents" value={metrics.length} trend="Stable"/>
      </div>

      <div className="grid2">
        <div className="card">
          <h3>Deadline vs Actual Duration</h3>
          <ResponsiveContainer width="100%" height={300}>
            <LineChart data={trend}>
              <CartesianGrid strokeDasharray="3 3" stroke="#334155"/>
              <XAxis dataKey="time" stroke="#64748b" tick={{fontSize:11}}/>
              <YAxis stroke="#64748b"/>
              <Tooltip contentStyle={ttStyle}/>
              <Legend/>
              <Line type="monotone" dataKey="deadline" stroke="#60a5fa" name="Deadline" dot={false}/>
              <Line type="monotone" dataKey="duration" stroke="#ef4444" name="Actual" dot={false}/>
            </LineChart>
          </ResponsiveContainer>
        </div>

        <div className="card">
          <h3>Decision Status Distribution</h3>
          <ResponsiveContainer width="100%" height={300}>
            <PieChart>
              <Pie data={statusDist} cx="50%" cy="50%" outerRadius={90} dataKey="value" label={({name,value})=>`${name}: ${value}`}>
                {statusDist.map((_,i)=><Cell key={i} fill={COLORS[i]}/>)}
              </Pie>
              <Tooltip contentStyle={ttStyle}/>
            </PieChart>
          </ResponsiveContainer>
        </div>

        <div className="card span2">
          <h3>Agent Performance</h3>
          <ResponsiveContainer width="100%" height={300}>
            <BarChart data={metrics}>
              <CartesianGrid strokeDasharray="3 3" stroke="#334155"/>
              <XAxis dataKey="agent" stroke="#64748b"/>
              <YAxis stroke="#64748b"/>
              <Tooltip contentStyle={ttStyle}/>
              <Legend/>
              <Bar dataKey="successRate" fill="#10b981" name="Success Rate %"/>
              <Bar dataKey="avgLatency" fill="#f59e0b" name="Avg Latency (ms)"/>
            </BarChart>
          </ResponsiveContainer>
        </div>

        <div className="card span2">
          <h3>Drift Events by Type</h3>
          <ResponsiveContainer width="100%" height={280}>
            <BarChart data={driftDist}>
              <CartesianGrid strokeDasharray="3 3" stroke="#334155"/>
              <XAxis dataKey="name" stroke="#64748b"/>
              <YAxis stroke="#64748b"/>
              <Tooltip contentStyle={ttStyle}/>
              <Bar dataKey="value" fill="#a855f7" name="Count"/>
            </BarChart>
          </ResponsiveContainer>
        </div>
      </div>
    </div>
  );
}

/* ── Episodes ──────────────────────────────────────────── */
function Episodes({episodes}){
  const badge={success:'badge-success',timeout:'badge-timeout',degraded:'badge-degraded',failed:'badge-failed'};
  return(
    <div className="card" style={{marginTop:0}}>
      <h3>Recent Decision Episodes</h3>
      <div style={{overflowX:'auto'}}>
        <table>
          <thead><tr><th>Episode ID</th><th>Agent</th><th>Status</th><th>Deadline</th><th>Duration</th><th>Freshness</th><th>Outcome</th></tr></thead>
          <tbody>
            {episodes.slice(-25).reverse().map(e=>(
              <tr key={e.id}>
                <td className="mono">{e.id.slice(0,18)}…</td>
                <td>{e.agent}</td>
                <td><span className={`badge ${badge[e.status]}`}>{e.status}</span></td>
                <td>{e.deadline.toFixed(0)}ms</td>
                <td>{e.duration.toFixed(0)}ms</td>
                <td>{e.freshness.toFixed(1)}%</td>
                <td>{e.outcome}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}

/* ── Drift ─────────────────────────────────────────────── */
function Drift({drifts}){
  return(
    <div className="card" style={{marginTop:0}}>
      <h3 className="flex-center"><AlertIcon/> Drift Events</h3>
      <div className="scroll-box" style={{marginTop:12}}>
        {drifts.slice(-25).reverse().map(d=>(
          <div key={d.id} className={`drift-item drift-${d.severity}`}>
            <div className="drift-header">
              <div>
                <div className="drift-title">{d.type} Drift</div>
                <div className="drift-ep">{d.epId.slice(0,24)}…</div>
                <div className="drift-hint">{d.patch}</div>
              </div>
              <span className={`sev sev-${d.severity}`}>{d.severity}</span>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

/* ── Export ─────────────────────────────────────────────── */
function Export({episodes,drifts,metrics}){
  const doExport=(fmt)=>{
    if(fmt==='json'){
      const d=JSON.stringify({episodes,drifts,metrics,timestamp:new Date().toISOString()},null,2);
      dl(d,'application/json',`overwatch-${new Date().toISOString().slice(0,10)}.json`);
    } else {
      const hdr='id,agent,status,deadline,duration,freshness,outcome\n';
      const rows=episodes.map(e=>`${e.id},${e.agent},${e.status},${e.deadline.toFixed(0)},${e.duration.toFixed(0)},${e.freshness.toFixed(1)},${e.outcome}`).join('\n');
      dl(hdr+rows,'text/csv',`overwatch-episodes-${new Date().toISOString().slice(0,10)}.csv`);
    }
  };
  const dl=(content,type,name)=>{const b=new Blob([content],{type});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=name;a.click();URL.revokeObjectURL(u);};

  return(
    <div className="card" style={{marginTop:0}}>
      <h3>Export Dashboard Data</h3>
      <div className="export-grid">
        <div className="export-stat"><div className="export-stat-label">Decision Episodes</div><div className="export-stat-value">{episodes.length}</div></div>
        <div className="export-stat"><div className="export-stat-label">Drift Events</div><div className="export-stat-value">{drifts.length}</div></div>
        <div className="export-stat"><div className="export-stat-label">Agents Tracked</div><div className="export-stat-value">{metrics.length}</div></div>
        <div className="export-stat"><div className="export-stat-label">Data Points</div><div className="export-stat-value">{episodes.length*7+drifts.length*4}</div></div>
      </div>
      <div style={{display:'flex',gap:12}}>
        <button className="btn" onClick={()=>doExport('json')}>Export JSON</button>
        <button className="btn" onClick={()=>doExport('csv')} style={{background:'#059669'}}>Export CSV</button>
      </div>
      <p className="note">Exports all decision episodes, drift events, and agent metrics for offline analysis.</p>
    </div>
  );
}

/* ── App ───────────────────────────────────────────────── */
function App(){
  const [episodes,setEpisodes]=useState([]);
  const [drifts,setDrifts]=useState([]);
  const [metrics,setMetrics]=useState([]);
  const [view,setView]=useState('overview');
  const [auto,setAuto]=useState(true);
  const [ts,setTs]=useState('');

  const load=useCallback(()=>{setEpisodes(mockEpisodes(100));setDrifts(mockDrifts(100));setMetrics(mockMetrics());setTs(new Date().toLocaleTimeString());},[]);

  useEffect(()=>{load();if(auto){const id=setInterval(load,5000);return()=>clearInterval(id);}},[auto,load]);

  const views=['overview','episodes','drift','export'];

  return(
    <div>
      <header className="header">
        <div className="header-inner">
          <div style={{display:'flex',alignItems:'center'}}>
            <span className="logo">Σ OVERWATCH</span>
            <span className="logo-sub">Control Plane Dashboard</span>
          </div>
          <div className="controls">
            <label><input type="checkbox" checked={auto} onChange={e=>setAuto(e.target.checked)}/> Auto-Refresh (5s)</label>
            <span className="ts">Updated: {ts}</span>
          </div>
        </div>
      </header>

      <nav><div className="inner">
        {views.map(v=><button key={v} className={view===v?'active':''} onClick={()=>setView(v)}>{v[0].toUpperCase()+v.slice(1)}</button>)}
      </div></nav>

      <main>
        {view==='overview'&&<Overview episodes={episodes} drifts={drifts} metrics={metrics}/>}
        {view==='episodes'&&<Episodes episodes={episodes}/>}
        {view==='drift'&&<Drift drifts={drifts}/>}
        {view==='export'&&<Export episodes={episodes} drifts={drifts} metrics={metrics}/>}
      </main>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
